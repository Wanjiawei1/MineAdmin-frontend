import{u as C}from"./useMessage-npDFBwy-.js";import{g as R}from"./getOnlyWorkAreaHeight-MFsugYQx.js";import{p as O,c as j,s as D}from"./index-CzdtxYH6.js";import{_ as z}from"./menu-tree.vue_vue_type_script_setup_true_lang-DUMmhR0Y.js";import{_ as B}from"./menu-form.vue_vue_type_script_setup_true_lang-3yHMP28f.js";import{d as V,r as l,o as $,e as A,av as L,w as P,O as s,f as U,h as W,j as m,b as h,ah as S,ag as H,z as q,al as G,b7 as E,W as b}from"./index-BsGhlh_X.js";import{u as I}from"./useTrans-kmCwB86_.js";import"./useLocalTrans-APekFW45.js";import"./overlayscrollbars-vue-BeccWTt5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./button-permission.vue_vue_type_script_setup_true_lang-B6g2lqUj.js";import"./useTable-Bt07anPD.js";import"./index.es-CqpDtOvG.js";import"./__commonjsHelpers__-CqkleIqs.js";const J={class:"relative w-full overflow-hidden b-r-1 b-r-gray-2 b-r-solid pr-5 lg:w-4/12 dark-b-r-dark-3"},K={class:"relative mt-3 h-[calc(100%-250px)] w-full overflow-x-hidden overflow-y-auto pr-5 lg:mt-0 lg:h-full"},Q={class:"sticky top-0 z-2 flex items-center justify-between b-b-1 b-b-gray-1 b-b-solid bg-white pb-3 text-base dark-b-b-dark-4 dark-bg-dark-8"},me=V({name:"permission:menu",__name:"index",setup(X){const f=l([]),T=l([]),o=l(null),d=l(),y=l(),x=l({id:void 0,parent_id:void 0,name:"",path:"",meta:{title:"新增顶级菜单",type:"M",componentSuffix:".vue",componentPath:"modules/",breadcrumbEnable:!0,copyright:!0,hidden:!1,affix:!1,cache:!0,activeName:"",auth:[],role:[],user:[]},component:"",sort:0,status:1,btnPermission:[]}),p=l(!1),u=I().globalTrans,c=C();async function _(){const{data:e}=await O();f.value=e,f.value.map(t=>v(t.id))}function v(e,t=!0){var a;const n=y.value.treeRef.elTree;if(n){const r=(a=n.store._getAllNodes())==null?void 0:a.find(i=>e===i.data.id);r&&(r.expanded=t)}}$(async()=>{await _()}),b("newMenu",x),b("menuList",f),b("defaultExpandNodes",T),b("setNodeExpand",v);function F(){var e,t,n,a;o.value=Object.assign(x.value,{}),o.value.meta.title="",(t=(e=d.value)==null?void 0:e.setData)==null||t.call(e,o.value),(a=(n=d.value)==null?void 0:n.menuForm)==null||a.getElFormRef().resetFields()}function N(){const{model:e}=d.value,{getElFormRef:t}=d.value.menuForm,n=t();p.value=!0,n.validate().then(()=>{e.parent_id||(e.parent_id=0),e.dataType&&e.dataType==="add"?j(e).then(async a=>{a.code===E.SUCCESS?c.success(u("crud.createSuccess")):c.error(a.message),await _(),F(),v(e.parent_id)}):o.value!==null&&e.dataType==="edit"&&e.id?D(e.id,e).then(async a=>{a.code===E.SUCCESS?c.success(u("crud.updateSuccess")):c.error(a.message),await _(),v(e.id)}):c.alertError(u("baseMenuManage.addError")),p.value=!1}).catch(a=>{var r,i;(r=Object.keys(a))!=null&&r[0]&&n.scrollToField((i=Object.keys(a))==null?void 0:i[0]),p.value=!1})}return(e,t)=>{var r,i,w;const n=A("el-button"),a=L("loading");return P((W(),U("div",{class:"mine-card menu-container h-full gap-x-4.5 lg:flex",style:G({height:`${s(R)()+12}px`})},[m("div",J,[h(z,{ref_key:"menuTreeRef",ref:y,data:s(f),onMenuSelect:t[0]||(t[0]=k=>{var g,M;o.value=k,(M=(g=s(d))==null?void 0:g.setData)==null||M.call(g,k)})},null,8,["data"])]),m("div",K,[m("div",Q,[m("span",null,S(s(o)?(r=s(o).meta)!=null&&r.i18n?s(u)((i=s(o).meta)==null?void 0:i.i18n):(w=s(o).meta)==null?void 0:w.title:s(u)("baseMenuManage.addTopMenu")),1),m("div",null,[h(n,{type:"primary",onClick:N},{default:H(()=>[q(S(s(u)("crud.save")),1)]),_:1})])]),h(B,{ref_key:"menuFormRef",ref:d},null,512)])],4)),[[a,s(p)]])}}});export{me as default};
