import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-j-gfJfmA.js";import{M as Q,u as X}from"./panel-nnwu6cSX.js";import{d as N,b5 as Y,b6 as ee,bj as te,bh as le,aj as $,h,ag as R,j as I,b as n,m as q,O as s,r as y,c as ae,V as w,bk as se,bl as oe,e as M,ab as T,ap as P,f as ne,as as U,l as S,al as j,aZ as E,w as ie,v as re,z as ue,ah as me}from"./index-fEaXY3hb.js";import{u as ce}from"./useLocalTrans-BLiEMMr_.js";import{u as de}from"./useMessage-BpWl7_QK.js";import{i as pe}from"./array-RcmzBJtc.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve=(a,i)=>Math.floor(Math.random()*(i-a+1)+a),ge=(a,i="")=>{const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"+i;return pe(a,r=>r+u.charAt(ve(0,u.length-1)),"")},be={class:"h-[595px]"},ye=N({name:"MaResourcePicker",__name:"index",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:Y(["cancel","confirm"],["update:visible"]),setup(a,{emit:i}){const u=i,r=ee(a,"visible");function p(){r.value=!1,u("cancel")}function k(m){r.value=!1,u("confirm",m)}const _=te(le(),["onConfirm","onCancel"]);return(m,f)=>{const z=K;return h(),$(z,{modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=g=>r.value=g),title:"资源选择器","append-to-body":"","destroy-on-close":"","align-center":"",footer:!1},{default:R(()=>[I("div",be,[n(Q,q(s(_),{onCancel:p,onConfirm:k}),null,16)])]),_:1},8,["modelValue"])}}}),he={class:"ma-preview-mask"},ke={key:0,class:"pt-1 text-sm text-dark-50 dark-text-gray-3"},A=N({name:"MaUploadImage",__name:"index",props:{modelValue:{default:null},title:{default:null},size:{default:120},fileSize:{default:()=>10*1024*1024},fileType:{default:()=>["image/jpeg","image/png","image/gif"]},limit:{default:5},multiple:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:i}){const u=i,r=ge(5),p=de(),k=ce(),_=y(),m=y(!1),f=y([]),z=y([]),g=ae(()=>({width:`${a.size??120}px`,height:`${a.size??120}px`}));function B(){return n("a",{class:"ma-upload-container",style:g.value},[n(M("el-tooltip"),{content:k("openResource")},{default:()=>[n("a",{class:"ma-resource-btn",onClick:e=>{e.stopPropagation(),m.value=!0}},[n(S,{name:"material-symbols:folder-open-outline-rounded",size:18},null)])]}),n("div",{class:"mt-18% flex flex-col items-center"},[n(S,{name:"ep:plus",size:20},null),n("span",{class:"mt-1 text-[14px]"},[a.title??k("uploadImage")])])])}const l=y([]);function V(){var e;u("update:modelValue",a.multiple?l.value.map(t=>t.url):(e=l.value[0])==null?void 0:e.url)}function O(e){const t=l.value.findIndex(c=>{var C;return((C=c.response)==null?void 0:C.data.id)===e.data.id});l.value[t].name=e.data.origin_name,l.value[t].url=e.data.url,V()}function W(e){return a.fileType.includes(e.type)?a.fileSize<e.size?(p.error(`只允许上传${a.fileSize}字节大小的文件`),!1):!0:(p.error(`只允许上传：${a.fileType.join(", ")}`),!1)}function Z(){p.error(`当前最多只能上传 ${a.limit} 张图片，请重新选择上传！`)}function F(){p.error("图片上传失败，请您重新上传！")}w(()=>l.value.length,e=>{const t=document.querySelector(`.ma-upload-${r} .el-upload--text`);t&&(t.style.display=e>0?"none":"block")},{immediate:!0});const G=se(()=>{var e;f.value=[],(e=l.value)==null||e.map(t=>{f.value.push(t.url)})});return w(()=>l.value,async()=>{await G()},{immediate:!0,deep:!0}),w(()=>a.modelValue,e=>{var t;if(!e)return l.value=[],!1;oe(e)?l.value=e.map(c=>({name:c.split("/").pop(),url:c})):l.value=[{name:(t=e==null?void 0:e.split("/"))==null?void 0:t.pop(),url:e}]},{immediate:!0,deep:!0}),(e,t)=>{const c=S,C=M("el-image"),H=ye,J=M("el-upload");return h(),$(J,q({"file-list":s(l),"onUpdate:fileList":t[4]||(t[4]=o=>T(l)?l.value=o:null),class:`ma-upload-${s(r)}`,"before-upload":W,"http-request":s(X),"on-success":O,"on-exceed":Z,"on-error":F,multiple:e.multiple,limit:e.limit},e.$attrs),{file:R(({file:o,index:v})=>[I("div",{class:"ma-preview-list ma-upload-container relative",style:j(s(g))},[I("div",he,[n(c,{name:"weui:eyes-on-filled",class:"icon",size:20,onClick:t[0]||(t[0]=()=>{var d,b,x,D;return(D=(x=(b=(d=s(z))==null?void 0:d.$el)==null?void 0:b.children[0])==null?void 0:x.click)==null?void 0:D.call(x)})}),n(c,{name:"material-symbols:delete",class:"icon",size:20,onClick:()=>{s(l).splice(v,1),V()}},null,8,["onClick"])]),n(C,{ref_key:"ElImageRefs",ref:z,src:o==null?void 0:o.url,class:"absolute rounded-md",style:j(s(g)),fit:"cover","zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":s(f),"initial-index":v},null,8,["src","style","preview-src-list","initial-index"])],4),v===s(l).length-1&&e.multiple&&s(l).length<e.limit?(h(),$(E(B()),{key:0,class:"cursor-pointer",onClick:t[1]||(t[1]=()=>{var d,b;return(b=(d=s(_))==null?void 0:d.click)==null?void 0:b.call(d)})})):U("",!0)]),tip:R(()=>[s(l).length<1?(h(),ne("div",ke,[P(e.$slots,"tip",{},()=>{var o;return[ue(me((o=e.$attrs)==null?void 0:o.tip),1)]},!0)])):U("",!0)]),default:R(()=>[P(e.$slots,"default",{},()=>[ie((h(),$(E(B()),{ref_key:"uploadBtnRef",ref:_},null,512)),[[re,s(l).length===0]])],!0),n(H,{visible:s(m),"onUpdate:visible":t[2]||(t[2]=o=>T(m)?m.value=o:null),multiple:e.multiple,limit:e.limit,onConfirm:t[3]||(t[3]=o=>{l.value=o.map(v=>({name:v.ogirin_name,url:v.url})),V()})},null,8,["visible","multiple","limit"])]),_:3},16,["file-list","class","http-request","multiple","limit"])}}});function L(a){const i=a;i.__i18n=i.__i18n||[],i.__i18n.push({locale:"",resource:{en:{openResource:{t:0,b:{t:2,i:[{t:3}],s:"Open resource"}},uploadImage:{t:0,b:{t:2,i:[{t:3}],s:"Upload image"}}},zh_CN:{openResource:{t:0,b:{t:2,i:[{t:3}],s:"打开资源选择器"}},uploadImage:{t:0,b:{t:2,i:[{t:3}],s:"上传图片"}}},zh_TW:{openResource:{t:0,b:{t:2,i:[{t:3}],s:"打開資源選擇器"}},uploadImage:{t:0,b:{t:2,i:[{t:3}],s:"上載圖片"}}}}})}typeof L=="function"&&L(A);const we=fe(A,[["__scopeId","data-v-958d04c0"]]);export{we as _};
