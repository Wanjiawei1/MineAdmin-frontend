import{p as M}from"./role-3T4fzb02.js";import{g as U,a as y}from"./user-DRXzZXp8.js";import{u as F}from"./useForm-OIqUAT9H.js";import{u as _}from"./useMessage-BpWl7_QK.js";import{d as b,b5 as v,r as C,b6 as P,aj as V,h as p,ao as k,ak as $,m as q,O as R,aA as H,b2 as w,ag as E,ap as z,aq as B,ar as O,b7 as S,e as T,ab as A}from"./index-fEaXY3hb.js";import{u as I}from"./useTrans-BxQFVQVs.js";const K=b({name:"MaRemoteSelect",__name:"index",props:v({api:{type:Function},url:{},axiosConfig:{},dataHandle:{type:Function}},{modelValue:{},modelModifiers:{}}),emits:v(["select-item","change"],["update:modelValue"]),setup(m,{expose:h,emit:d}){var c;const e=m,s=d,f=C(),r=_(),t=P(m,"modelValue"),a=C([]);function n(u){s("change",u);const l=f.value.valueKey;s("select-item",a.value.find(o=>o[l]===u)??null)}function i(){var u;if(e!=null&&e.api&&typeof e.api=="function")e.api(e.axiosConfig).then(l=>{var o;a.value=((o=e==null?void 0:e.dataHandle)==null?void 0:o.call(e,l))??l.data}).catch(l=>{r.error(l)});else if(e!=null&&e.url){const l=w()[((u=e==null?void 0:e.axiosConfig)==null?void 0:u.method)??"get"];l(e==null?void 0:e.url,e==null?void 0:e.axiosConfig).then(o=>{var g;a.value=((g=e==null?void 0:e.dataHandle)==null?void 0:g.call(e,o))??o.data}).catch(o=>{r.error(o)})}else r.error("MaRemoteSelect 组件未指定 api 或 url ")}return(((c=e==null?void 0:e.axiosConfig)==null?void 0:c.autoRequest)??!0)&&i(),h({refresh:()=>i(),selectRef:f}),(u,l)=>(p(),V(R(H),q({ref_key:"elSelectV2Ref",ref:f},u.$attrs,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value=o),options:R(a),clearable:"",onChange:n}),k({_:2},[$(u.$slots,(o,g)=>({name:g,fn:E(x=>[z(u.$slots,g,B(O(x)))])}))]),1040,["modelValue","options"]))}}),N=b({__name:"setRoleForm",props:{data:{default:null}},setup(m,{expose:h}){const d=I().globalTrans,e=C(),s=C({roleCode:[]});F("userRoleForm").then(async r=>{var t,a;if((t=m.data)!=null&&t.id){s.value.id=m.data.id;const n=await U((a=m.data)==null?void 0:a.id);n.code===S.SUCCESS&&(s.value.roleCode=n.data.map(i=>i.code))}r.setItems([{label:()=>d("baseUserManage.role"),prop:"roleCode",render:()=>K,renderProps:{multiple:!0,placeholder:d("form.pleaseSelect",{msg:d("baseUserManage.role")}),api:()=>new Promise(n=>n(M({page_size:999}))),dataHandle:n=>{var i;return(i=n.data.list)==null?void 0:i.map(c=>({label:`${c.name}-${c.code}`,value:c.code}))}},itemProps:{rules:[{required:!0,message:d("form.requiredSelect",{msg:d("baseUserManage.role")})}]}}]),r.setOptions({labelWidth:"80px"})});function f(){return new Promise((r,t)=>{y(s.value.id,s.value.roleCode).then(a=>{a.code===S.SUCCESS?r(a):t(a)}).catch(a=>{t(a)})})}return h({saveUserRole:f,maForm:e}),(r,t)=>{const a=T("ma-form");return p(),V(a,{ref_key:"userRoleForm",ref:e,modelValue:R(s),"onUpdate:modelValue":t[0]||(t[0]=n=>A(s)?s.value=n:null)},null,8,["modelValue"])}}});export{N as _};
