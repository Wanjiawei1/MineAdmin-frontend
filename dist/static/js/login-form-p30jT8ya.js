import{d as M,C as P,r as p,o as L,f as x,h as C,G as w,B as $,y as T,J as z,X as R,e as S,b0 as I,j as u,b as h,ah as y,O as n,ag as k,ai as j,z as U,l as q}from"./index-BsGhlh_X.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./__commonjsHelpers__-CqkleIqs.js";const O=["width","height"],N=M({name:"MaVerifyCode",__name:"index",props:{height:{default:36},width:{default:120},pool:{default:"abcdefghjkmnpqrstuvwxyz23456789"},size:{default:4},showError:{type:Boolean,default:!0}},setup(_,{expose:s}){const r=_,{t:b}=P({inheritLocale:!0,useScope:"local"}),l=p(""),c=p();function m(e){return(!e||e.length===0)&&r.showError?(w.error(b("MaVerifyCodeNullError")),!1):e.toLowerCase()!==l.value.toLowerCase()&&r.showError?(w.error(b("MaVerifyCodeError")),d(),!1):!0}function a(e,o){return Number.parseInt((Math.random()*(o-e)+e).toString())}function t(e,o){const i=a(e,o),f=a(e,o),V=a(e,o);return`rgb(${i},${f},${V})`}function d(){l.value="";const e=c.value.getContext("2d");e.fillStyle=t(230,255),e.fillRect(0,0,r.width,r.height);for(let o=0;o<r.size;o++){const i=`${r.pool[a(0,r.pool.length)]}`;l.value+=i,e.font="36px Simhei",e.textAlign="center",e.fillStyle=t(80,150),e.fillText(i,(o+1)*a(20,25),r.height/2+13)}for(let o=0;o<5;o++)e.beginPath(),e.moveTo(a(0,r.width),a(0,r.height)),e.lineTo(a(0,r.width),a(0,r.height)),e.strokeStyle=t(180,230),e.closePath(),e.stroke();for(let o=0;o<40;o++)e.beginPath(),e.arc(a(0,r.width),a(0,r.height),1,0,2*Math.PI),e.closePath(),e.fillStyle=t(150,200),e.fill();return e.restore(),e.save(),l}L(()=>{d()});function v(){d()}return s({checkResult:m,refresh:v}),(e,o)=>(C(),x("canvas",{ref_key:"el",ref:c,class:"canvas",width:r.width,height:r.height,onClick:v},null,8,O))}});function E(_){const s=_;s.__i18n=s.__i18n||[],s.__i18n.push({locale:"",resource:{zh_CN:{MaVerifyCodeError:{t:0,b:{t:2,i:[{t:3}],s:"验证码错误"}},MaVerifyCodeNullError:{t:0,b:{t:2,i:[{t:3}],s:"验证码不能为空"}}},zh_TW:{MaVerifyCodeError:{t:0,b:{t:2,i:[{t:3}],s:"驗證碼錯誤"}},MaVerifyCodeNullError:{t:0,b:{t:2,i:[{t:3}],s:"驗證碼不能為空"}}},en:{MaVerifyCodeError:{t:0,b:{t:2,i:[{t:3}],s:"Verification code error"}},MaVerifyCodeNullError:{t:0,b:{t:2,i:[{t:3}],s:"The verification code cannot be empty"}}}}})}typeof E=="function"&&E(N);const A=F(N,[["__scopeId","data-v-da73e09a"]]),D={class:"mine-login-form-item"},G={class:"mine-login-form-item-title"},J={class:"mine-login-form-item"},W={class:"mine-login-form-item-title"},X={key:0,class:"mine-login-form-item"},H={class:"mine-login-form-item-title"},K={class:"ml-0.5 w-30 flex items-center justify-center text-sm"},Q={class:"mine-login-form-item mt-2"},Y=M({__name:"login-form",setup(_){const{t:s}=P(),r=$(),b=T(),l=z(),c=p(!1),m=p(!0),a=p(),t=R({username:"",password:"",code:""});function d(e){const o=e==null?void 0:e.target;t[o.name]===void 0||t[o.name]===""?(o.classList.add("!ring-red-5"),w.error(s(`loginForm.${o.name}Placeholder`)),m.value=!1):(o.classList.remove("!ring-red-5"),m.value=!0)}async function v(){if(Object.keys(t).forEach(e=>{(t[e]===void 0||t[e]==="")&&(w.error(s(`loginForm.${e}Placeholder`)),m.value=!1)}),!m.value)return!1;if(!a.value.checkResult(t.code))return t.code="",!1;c.value=!0,r.login(t).then(async e=>{var f;const o=b.getSettings("welcomePage").path??null,i=((f=l.currentRoute.value.query)==null?void 0:f.redirect)??void 0;e&&await l.push({path:i??o??"/"}),c.value=!1}).catch(()=>c.value=!1)}return(e,o)=>{const i=S("m-input"),f=A,V=q,B=S("m-button");return C(),x("form",{class:"mine-login-form",onSubmit:I(v,["prevent"])},[u("div",D,[u("div",G,y(n(s)("loginForm.usernameLabel")),1),h(i,{modelValue:n(t).username,"onUpdate:modelValue":o[0]||(o[0]=g=>n(t).username=g),class:"!bg-white !text-black !ring-gray-2 !focus-ring-[rgb(var(--ui-primary))] !placeholder-stone-4",name:"username",placeholder:n(s)("loginForm.usernamePlaceholder"),onBlur:d},null,8,["modelValue","placeholder"])]),u("div",J,[u("div",W,y(n(s)("loginForm.passwordLabel")),1),h(i,{modelValue:n(t).password,"onUpdate:modelValue":o[1]||(o[1]=g=>n(t).password=g),class:"!bg-white !text-black !ring-gray-2 !focus-ring-[rgb(var(--ui-primary))] !placeholder-stone-4",name:"password",type:"password",placeholder:n(s)("loginForm.passwordPlaceholder"),onBlur:d},null,8,["modelValue","placeholder"])]),(C(),x("div",X,[u("div",H,y(n(s)("loginForm.codeLabel")),1),h(i,{modelValue:n(t).code,"onUpdate:modelValue":o[2]||(o[2]=g=>n(t).code=g),class:"!bg-white !text-black !ring-gray-2 !focus-ring-[rgb(var(--ui-primary))] !placeholder-stone-4",name:"code",placeholder:n(s)("loginForm.codePlaceholder"),onBlur:d},{suffix:k(()=>[u("div",K,[h(f,{ref_key:"codeRef",ref:a},null,512)])]),_:1},8,["modelValue","placeholder"])])),u("div",Q,[h(B,{type:"submit",class:j(["!bg-[rgb(var(--ui-primary))] !text-gray-1 !active-bg-[rgb(var(--ui-primary))] !hover-bg-[rgb(var(--ui-primary)/.75)]",{loading:n(c)}])},{default:k(()=>[h(V,{name:"formkit:submit"}),U(" "+y(n(s)("loginForm.loginButton")),1)]),_:1},8,["class"])])],32)}}}),te=F(Y,[["__scopeId","data-v-3ed51d5a"]]);export{te as default};
