import{d as k,r as d,b7 as R,b as f,l as S,n as g,e as y,aj as T,h as w,ab as x,O as F}from"./index-BsGhlh_X.js";import{g as P,a as K}from"./role-2UO_91S_.js";import{p as U,_ as V}from"./index-CzdtxYH6.js";import{u as M}from"./useForm-Dr9zNnRS.js";import{u as B}from"./useTrans-kmCwB86_.js";const N=k({__name:"setPermissionForm",props:{data:{default:null}},setup(p,{expose:C}){const u=B().globalTrans,v=d(),n=d({}),_=d(!1),c=d();M("userRoleForm").then(async r=>{var a,h;const s=[];if((a=p.data)!=null&&a.id){n.value.id=p.data.id;const e=await P((h=p.data)==null?void 0:h.id);e.code===R.SUCCESS&&e.data&&(e.data.map(o=>{s.push(o.name)}),_.value=!0)}const l=await U();r.setItems([{label:()=>u("baseRoleManage.permission"),prop:"permission_id",render:()=>V,renderProps:{ref:e=>c.value=e,class:"w-full",showCheckbox:!0,treeKey:"meta.title",placeholder:u("form.pleaseSelect",{msg:u("baseRoleManage.permission")}),nodeKey:"name",data:l.data},renderSlots:{default:({data:e})=>{var o,m,t,i;return f("div",{class:"mine-tree-node"},[f("div",{class:"label"},[((o=e.meta)==null?void 0:o.icon)&&f(S,{name:(m=e.meta)==null?void 0:m.icon,size:16},null),(t=e.meta)!=null&&t.i18n?u((i=e.meta)==null?void 0:i.i18n):e.meta.title??"unknown"])])}}}]),r.setOptions({labelWidth:"80px"}),await g(()=>{var e,o;(o=c.value)==null||o.setCheckStrictly(!!((e=n.value)!=null&&e.id)),setTimeout(()=>{var m,t,i;(i=(t=(m=c.value)==null?void 0:m.elTree)==null?void 0:t.setCheckedKeys)==null||i.call(t,s)},50)})});function b(){return new Promise((r,s)=>{const l=c.value.elTree;K(n.value.id,l.getCheckedKeys()).then(a=>{a.code===R.SUCCESS?r(a):s(a)}).catch(a=>{s(a)})})}return C({saveUserRole:b,maForm:v}),(r,s)=>{const l=y("ma-form");return w(),T(l,{ref_key:"userRoleForm",ref:v,modelValue:F(n),"onUpdate:modelValue":s[0]||(s[0]=a=>x(n)?n.value=a:null)},null,8,["modelValue"])}}});export{N as _};
