import{d as F,_ as H}from"./index-Baj3Os4U.js";import{d as K,r as N,i as B,o as L,a2 as P,e as f,av as W,aj as c,h as m,ag as o,b as i,O as t,z as y,ah as g,j as b,as as D,l as G,ai as J,w as $,b0 as R,m as Q}from"./index-fEaXY3hb.js";import{g as U}from"./getOnlyWorkAreaHeight-MFsugYQx.js";import{u as X}from"./useMessage-BpWl7_QK.js";import{u as Y}from"./useTrans-BxQFVQVs.js";const Z={class:"mine-tree-node"},ee={class:"label"},ie=K({__name:"menu-tree",emits:["menu-select"],setup(te,{expose:V,emit:j}){const l=j,r=N(),E=X(),h=B("newMenu"),O=B("setNodeExpand"),s=Y().globalTrans,k=N({M:{color:"primary",label:"菜单"},B:{color:"danger",label:"按钮"},L:{color:"success",label:"外链"},I:{color:"warning",label:"iFrame"}});function S(a){const n=h.value;n.dataType="add",n.id=void 0,n.parent_id=a.id,n.meta.title="新菜单",l("menu-select",n)}return V({treeRef:r}),L(async()=>{const a=()=>{const n=document.querySelector(".menu-container");n&&(n.style.height=`${U()}px`)};P(document.querySelector(".mine-main"),a)}),(a,n)=>{const u=G,q=f("el-tag"),p=f("el-button"),I=f("el-popconfirm"),A=H,v=W("auth");return m(),c(A,Q(a.$attrs,{ref_key:"maTreeRef",ref:r,"tree-key":"meta.title","highlight-current":"","expand-on-click-node":!1,"node-key":"id",indent:26,"auto-expand-parent":"",class:"mt-1 h-[200px] lg:h-[calc(100%-80px)]",onNodeClick:n[1]||(n[1]=d=>{l("menu-select",d)})}),{default:o(({node:d,data:e})=>{var x,C,M,w,T,z;return[b("div",Z,[b("div",ee,[(x=e.meta)!=null&&x.icon?(m(),c(u,{key:0,name:(C=e.meta)==null?void 0:C.icon,size:20},null,8,["name"])):D("",!0),y(" "+g((M=e.meta)!=null&&M.i18n?t(s)((w=e.meta)==null?void 0:w.i18n):e.meta.title??"unknown"),1)]),b("div",{class:J(["do",{"!inline-block":t(r).elTree.getCurrentKey()===e.id}])},[i(q,{type:t(k)[(T=e.meta)==null?void 0:T.type].color,class:"mr-2"},{default:o(()=>{var _;return[y(g(t(k)[(_=e.meta)==null?void 0:_.type].label),1)]}),_:2},1032,["type"]),((z=e.meta)==null?void 0:z.type)==="M"?$((m(),c(p,{key:0,size:"small",circle:"",type:"primary",onClick:R(_=>S(e),["stop"])},{default:o(()=>[i(u,{name:"ic:round-plus",size:20})]),_:2},1032,["onClick"])),[[v,["permission:menu:save"]]]):D("",!0),i(I,{title:t(s)("crud.delDataMessage"),"confirm-button-text":t(s)("crud.ok"),"cancel-button-text":t(s)("crud.cancel"),onConfirm:R(async()=>{if(e.children&&e.children.length>0){t(E).notifyError(t(s)("baseMenuManage.deleteChildren"));return}e.parent_id!==0&&(t(O)(e.parent_id,!0),l("menu-select",t(r).elTree.getCurrentNode())),await t(F)([e.id]),t(r).elTree.remove(d)},["stop"])},{reference:o(()=>[$((m(),c(p,{size:"small",circle:"",type:"danger"},{default:o(()=>[i(u,{name:"ic:round-minus",size:20})]),_:1})),[[v,["permission:menu:delete"]]])]),_:2},1032,["title","confirm-button-text","cancel-button-text","onConfirm"])],2)])]}),extra:o(()=>[i(p,{type:"primary",class:"w-full",onClick:n[0]||(n[0]=()=>l("menu-select",t(h)))},{default:o(()=>[y(g(t(s)("baseMenuManage.addTopMenu")),1)]),_:1})]),_:1},16)}}});export{ie as _};
