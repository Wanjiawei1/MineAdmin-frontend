import{b2 as Y,P as ge,b3 as be,at as te,b4 as ye,r as k,d as xe,b5 as le,b6 as ke,V as ie,c as we,o as Ce,ad as Se,e as b,f as _,h as m,j as u,b as h,O as n,ab as ze,ag as x,aj as D,as as B,l as Me,ah as M,F as A,ak as O,ai as se,z as W,ap as Ne,b7 as Ve,m as Be,b0 as Ee}from"./index-BsGhlh_X.js";import{P as Pe}from"./overlayscrollbars-vue-BeccWTt5.js";import{Q as De}from"./vue3-context-menu.es-DRG-aLUq.js";import{u as Ae}from"./useMessage-npDFBwy-.js";import{u as je}from"./useParentNode-CJHsJhLn.js";import{u as Le}from"./useTrans-kmCwB86_.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Re(r){return Y().delete(`/admin/attachment/${r}`)}function Fe(r,a){const i=document.createElement("div"),d={urlList:r,hideOnClickModal:!0,zIndex:2500,initialIndex:0,...a,onClose:()=>{te(null,i),document.body.contains(i)&&document.body.removeChild(i)}},w=ge(be,d);document.body.appendChild(i),te(w,i)}function ae(r,a,i){const d=w=>Y().post(a??"/admin/attachment/upload",w);return new Promise((w,s)=>{const f=new FormData;f.append(i??"file",r.file),d(f).then(C=>{C.code===200?w(C):s(C)}).catch(C=>{s(C)})})}const Ie=[{name:"local-image-upload",label:"图片上传",icon:"solar:upload-square-broken",upload:(r,a)=>{const i={file:r[0]};ae(i).then(()=>{var d;(d=a==null?void 0:a.getResourceList)==null||d.call(a)}).catch(d=>{throw new Error(d)})},uploadConfig:{accept:"image/*",limit:1},order:0},{name:"local-file-upload",label:"文件上传",icon:"hugeicons:file-upload",upload:(r,a)=>{const i={file:r[0]};ae(i).then(()=>{var d;(d=a==null?void 0:a.getResourceList)==null||d.call(a)}).catch(d=>{throw new Error(d)})},uploadConfig:{accept:".doc,.xls,.ppt,.txt,.pdf",limit:1},order:1}],Ue=ye("useResourceStore",()=>{const r=k([]),a=s=>r.value.find(f=>f.name===s),i=s=>a(s.name)?!1:(r.value.push(s),!0),d=s=>{r.value=r.value.filter(f=>f.name!==s)},w=()=>r.value;return Ie.forEach(s=>i(s)),{addButton:i,removeButton:d,getButton:a,getAllButton:w}}),$e={class:"ma-resource-panel h-full flex flex-col"},qe={class:"flex flex-col justify-between gap-y-1 md:flex-row"},He={class:"flex items-center justify-center"},Oe={class:"flex justify-end"},We={class:"mt-2 min-h-0 flex-1"},Qe={class:"flex flex-wrap px-[2px] pt-[2px]"},Ye=["onClick","onDblclick","onContextmenu"],Ge={class:"resource-item__cover"},Je={class:"relative m-[8px] h-[calc(100%-16px)] w-[calc(100%-16px)] flex items-center justify-center overflow-hidden"},Ke={class:"cursor-default overflow-hidden text-ellipsis whitespace-pre-wrap"},Xe={key:1,class:"relative m-[8px] h-[calc(100%-16px)] w-[calc(100%-16px)] flex items-center justify-center overflow-hidden"},Ze={class:"cursor-default overflow-hidden text-ellipsis whitespace-pre-wrap"},et={key:0,class:"resource-item__name cursor-default"},tt={class:"resource-item__selected"},lt={key:1,class:"h-full w-full flex flex-1 items-center justify-center"},it={class:"ma-resource-panel__footer flex justify-between pt-2"},st={class:"flex items-center"},at={key:0},nt={class:"ma-resource-dock"},ot={class:"res-app-container"},ct={class:"res-app"},rt=["name","onChange"],j="url",oe=xe({name:"MaResourcePanel",__name:"panel",props:le({multiple:{type:Boolean,default:!1},limit:{default:void 0},pageSize:{default:30},showAction:{type:Boolean,default:!0},dbClickConfirm:{type:Boolean,default:!1},defaultFileType:{},fileTypes:{}},{modelValue:{},modelModifiers:{}}),emits:le(["cancel","confirm"],["update:modelValue"]),setup(r,{emit:a}){const i=r,d=a,s=Le().globalTrans,f=Ae(),C=Ue(),L=ke(r,"modelValue"),T=k(i.defaultFileType??""),G=k([{label:()=>s("all"),value:"",icon:"ri:gallery-view-2",suffix:""},{label:()=>s("image"),value:"image",icon:"ri:image-line",suffix:"png,jpg,jpeg,gif,bmp"},{label:()=>s("video"),value:"video",icon:"ri:folder-video-line",suffix:"mp4,avi,wmv,mov,flv,mkv,webm"},{label:()=>s("audio"),value:"audio",icon:"ri:file-music-line",suffix:"mp3,wav,ogg,wma,aac,flac,ape,wavpack"},{label:()=>s("document"),value:"document",icon:"ri:file-text-line",suffix:"doc,docx,xls,xlsx,ppt,pptx,pdf"}]),E=k(!1),R=k([]),J=k(0),g=k([]),S=k([]),v=k({page:1,page_size:i.pageSize,origin_name:"",suffix:[]});async function N(e={}){E.value=!0;const{data:t}=await Y().get("/admin/attachment/list",{params:Object.assign({page_size:v.value.page_size,page:v.value.page},e)});J.value=t.total,R.value=t.list,E.value=!1}ie(()=>L.value,e=>{g.value=Array.isArray(e)?e:e?[e]:[]},{deep:!0}),ie(()=>g.value,e=>{const t=i.multiple?e:e[0];L.value&&L.value!==t&&(L.value=t)},{deep:!0});const ce=we(()=>E.value?v.value.page_size:30);function re(e){var t;T.value=e,v.value.suffix=((t=G.value.find(c=>c.value===e))==null?void 0:t.suffix)||[],N(v.value)}function Q(e){var t;if((t=e==null?void 0:e.mime_type)!=null&&t.startsWith("image"))return e.url}function F(e){const t=e[j];return g.value.includes(t)}function de(e){var t;return(t=e==null?void 0:e.mime_type)==null?void 0:t.startsWith("image")}function I(e){const t=e[j];if(i.multiple){if(i.limit&&g.value.length>=i.limit)return f.warning(s("maxSelect",{limit:i.limit}));g.value.push(t),S.value.find(c=>c[j]===t)||S.value.push(e)}else S.value=[e],g.value=[t]}function K(e){const t=e[j];g.value=g.value.filter(c=>c!==t),S.value=S.value.filter(c=>c[j]!==t)}function X(){g.value=[],S.value=[]}function ue(){d("cancel")}function Z(){d("confirm",S.value)}function me(e){F(e)?K(e):I(e)}function fe(e){X(),I(e),Z()}async function pe(e){try{if(await f.confirm(s("tips"))){const c=await Re(e);if(c.code!==Ve.SUCCESS){f.error(c.message);return}f.success(c.message),await N()}else f.info(s("cancelMessage"))}catch(t){t==="cancel"?f.info(s("cancelMessage")):f.error(s("errorMessage"))}}function ve(e,t){e.preventDefault(),De.showContextMenu({x:e.x,y:e.y,zIndex:9999,iconFontClass:"",customClass:"mine-contextmenu",items:[{label:s("select"),hidden:F(t),icon:"i-ri:check-fill",onClick:()=>{I(t)}},{label:s("deselect"),hidden:!F(t),icon:"i-ri:close-fill",onClick:()=>{K(t)}},{label:s("singleSelect"),icon:"i-ri:checkbox-circle-line",divided:!0,onClick:()=>{X(),I(t)}},{label:s("view"),icon:"i-ri:search-eye-line",disabled:!de(t),onClick:()=>{Fe([(t==null?void 0:t.url)??""])}},{label:s("delete"),icon:"i-material-symbols:delete-outline",onClick:()=>{(t==null?void 0:t.id)!==void 0&&pe(t.id)}}]})}function _e(e,t){var c;(c=t.upload)==null||c.call(t,e==null?void 0:e.target.files,{btn:t,getResourceList:N})}return Ce(async()=>{var t,c;await N();const e=document.getElementsByClassName("res-app");for(let V=0;V<e.length;V++){const y=e[V];y.addEventListener("click",o=>{var U,$,q;o.stopPropagation();const z=je(o,"div").children[0],p=(U=C.getAllButton())==null?void 0:U.find(H=>H.name===z.getAttribute("name"));p!=null&&p.click&&(($=p==null?void 0:p.click)==null||$.call(p,p,S)),p!=null&&p.upload&&((q=z==null?void 0:z.click)==null||q.call(z))}),(t=y==null?void 0:y.parentElement)==null||t.addEventListener("mouseover",()=>{const o=V;y.className="res-app main-effect",o===0?(e[1]&&(e[1].className="res-app second-effect"),e[2]&&(e[2].className="res-app third-effect")):o===e.length-1?(e[o-1]&&(e[o-1].className="res-app second-effect"),e[o-2]&&(e[o-2].className="res-app third-effect")):(e[o-1]&&(e[o-1].className="res-app second-effect"),e[o+1]&&(e[o+1].className="res-app second-effect"),o-2>-1&&e[o-2]&&(e[o-2].className="res-app third-effect"),o+2<e.length&&e[o+2]&&(e[o+2].className="res-app third-effect"))}),(c=y==null?void 0:y.parentElement)==null||c.addEventListener("mouseout",()=>{for(const o of e)o.className="res-app"})}}),Se(()=>{document.querySelectorAll(".ma-resource-dock .res-app").forEach(e=>{e.removeEventListener("mousemove",()=>{}),e.removeEventListener("mouseout",()=>{}),e.removeEventListener("click",()=>{})})}),(e,t)=>{const c=Me,V=b("el-segmented"),y=b("el-input"),o=b("el-image"),ee=b("el-skeleton-item"),z=b("el-skeleton"),p=b("el-space"),U=b("el-empty"),$=b("el-tag"),q=b("el-pagination"),H=b("el-button"),he=b("m-tooltip");return m(),_("div",$e,[u("div",qe,[u("div",null,[h(V,{modelValue:n(T),"onUpdate:modelValue":t[0]||(t[0]=l=>ze(T)?T.value=l:null),options:n(G),size:"default",block:"",onChange:re},{default:x(({item:l})=>[u("div",He,[l!=null&&l.icon?(m(),D(c,{key:0,name:l.icon,size:17,class:"mr-1 flex items-center justify-center"},null,8,["name"])):B("",!0),u("span",null,M(typeof l.label=="function"?l.label():l.label),1)])]),_:1},8,["modelValue","options"])]),u("div",Oe,[h(y,{modelValue:n(v).origin_name,"onUpdate:modelValue":t[1]||(t[1]=l=>n(v).origin_name=l),placeholder:n(s)("searchPlaceholder"),clearable:"",class:"w-full md:w-[180px]",onInput:t[2]||(t[2]=()=>{N(n(v))})},{suffix:x(()=>[h(c,{name:"i-material-symbols:search-rounded",size:20})]),_:1},8,["modelValue","placeholder"])])]),u("div",We,[n(E)||n(R).length?(m(),D(n(Pe),{key:0,class:"max-h-full",options:{scrollbars:{autoHide:"leave",autoHideDelay:100}}},{default:x(()=>[u("div",Qe,[h(p,{fill:"",wrap:"","fill-ratio":9},{default:x(()=>[(m(!0),_(A,null,O(n(R),l=>(m(),_("div",{key:l.id,class:se(["resource-item",{active:F(l)}]),onClick:P=>me(l),onDblclick:P=>fe(l),onContextmenu:P=>ve(P,l)},[u("div",Ge,[Q(l)?(m(),D(o,{key:0,src:Q(l),fit:"cover",class:"h-full w-full",lazy:""},{error:x(()=>[u("div",Je,[u("div",Ke,M(l.origin_name),1)])]),_:2},1032,["src"])):(m(),_("div",Xe,[u("div",Ze,M(l.origin_name),1)]))]),Q(l)?(m(),_("div",et,M(l.origin_name),1)):B("",!0),u("div",tt,[h(c,{class:"resource-item__selected-icon",name:"gravity-ui:circle-check-fill",size:18})])],42,Ye))),128)),n(R).length===0?(m(!0),_(A,{key:0},O(n(ce),l=>(m(),D(z,{key:l,class:"resource-skeleton relative",animated:""},{template:x(()=>[h(ee,{class:"absolute h-full w-full",variant:"rect"})]),_:2},1024))),128)):B("",!0),(m(),_(A,null,O(10,l=>u("div",{key:l,class:"resource-placeholder"})),64))]),_:1})])]),_:1})):(m(),_("div",lt,[h(U)]))]),u("div",it,[u("div",st,[i.multiple&&i.limit?(m(),D($,{key:0,size:"large",class:se(["mr-2",{"color-[var(--el-color-danger)]":i.limit&&n(g).length>=i.limit}])},{default:x(()=>[W(M(n(g).length)+" ",1),i.multiple&&i.limit?(m(),_(A,{key:0},[W(" /"+M(i.limit),1)],64)):B("",!0)]),_:1},8,["class"])):B("",!0),h(q,{"current-page":n(v).page,"onUpdate:currentPage":t[3]||(t[3]=l=>n(v).page=l),disabled:n(E),total:n(J),"page-size":n(v).page_size,background:"",layout:"prev, pager, next","pager-count":5,onChange:t[4]||(t[4]=l=>{n(v).page=l,N(n(v))})},null,8,["current-page","disabled","total","page-size"])]),i.showAction?(m(),_("div",at,[Ne(e.$slots,"actions",{},()=>[h(H,{onClick:ue},{default:x(()=>[W(M(n(s)("cancel")),1)]),_:1}),h(H,{type:"primary",onClick:Z},{default:x(()=>[W(M(n(s)("confirm")),1)]),_:1})],!0)])):B("",!0)]),u("div",nt,[(m(!0),_(A,null,O(n(C).getAllButton(),l=>(m(),_("div",ot,[u("div",ct,[h(he,{text:l.label},{default:x(()=>[u("input",Be({type:"file",name:l.name,class:"hidden"},{ref_for:!0},(l==null?void 0:l.uploadConfig)??{},{onChange:P=>_e(P,l),onClick:Ee(()=>{},["stop"])}),null,16,rt),h(c,{name:l.icon,class:"res-app-icon"},null,8,["name"])]),_:2},1032,["text"])])]))),256))])])}}});function ne(r){const a=r;a.__i18n=a.__i18n||[],a.__i18n.push({locale:"",resource:{en:{searchPlaceholder:{t:0,b:{t:2,i:[{t:3}],s:"Search for icons under this category"}},tips:{t:0,b:{t:2,i:[{t:3}],s:"Are you sure you want to delete this data?"}},cancelMessage:{t:0,b:{t:2,i:[{t:3}],s:"Deletion operation has been canceled"}},errorMessage:{t:0,b:{t:2,i:[{t:3}],s:"An error occurred during the deletion process"}},all:{t:0,b:{t:2,i:[{t:3}],s:"All"}},image:{t:0,b:{t:2,i:[{t:3}],s:"Image"}},video:{t:0,b:{t:2,i:[{t:3}],s:"Video"}},audio:{t:0,b:{t:2,i:[{t:3}],s:"Audio"}},document:{t:0,b:{t:2,i:[{t:3}],s:"Document"}},maxSelect:{t:0,b:{t:2,i:[{t:3,v:"You can select up to "},{t:4,k:"limit"},{t:3,v:" items."}]}},select:{t:0,b:{t:2,i:[{t:3}],s:"Select"}},deselect:{t:0,b:{t:2,i:[{t:3}],s:"Deselect"}},singleSelect:{t:0,b:{t:2,i:[{t:3}],s:"Select only this item"}},view:{t:0,b:{t:2,i:[{t:3}],s:"View"}},delete:{t:0,b:{t:2,i:[{t:3}],s:"Delete"}},cancel:{t:0,b:{t:2,i:[{t:3}],s:"Cancel"}},confirm:{t:0,b:{t:2,i:[{t:3}],s:"Confirm"}}},zh_CN:{searchPlaceholder:{t:0,b:{t:2,i:[{t:3}],s:"搜索此分类下的资源"}},tips:{t:0,b:{t:2,i:[{t:3}],s:"你确定要删除这条数据吗？"}},cancelMessage:{t:0,b:{t:2,i:[{t:3}],s:"删除操作已取消"}},errorMessage:{t:0,b:{t:2,i:[{t:3}],s:"删除过程中发生了错误"}},all:{t:0,b:{t:2,i:[{t:3}],s:"所有"}},image:{t:0,b:{t:2,i:[{t:3}],s:"图片"}},video:{t:0,b:{t:2,i:[{t:3}],s:"视频"}},audio:{t:0,b:{t:2,i:[{t:3}],s:"音频"}},document:{t:0,b:{t:2,i:[{t:3}],s:"文档"}},maxSelect:{t:0,b:{t:2,i:[{t:3,v:"最多选择"},{t:4,k:"limit"},{t:3,v:"个"}]}},select:{t:0,b:{t:2,i:[{t:3}],s:"选中"}},deselect:{t:0,b:{t:2,i:[{t:3}],s:"取消选中"}},singleSelect:{t:0,b:{t:2,i:[{t:3}],s:"独选此项"}},view:{t:0,b:{t:2,i:[{t:3}],s:"查看"}},delete:{t:0,b:{t:2,i:[{t:3}],s:"删除"}},cancel:{t:0,b:{t:2,i:[{t:3}],s:"取消"}},confirm:{t:0,b:{t:2,i:[{t:3}],s:"确认"}}},zh_TW:{searchPlaceholder:{t:0,b:{t:2,i:[{t:3}],s:"搜索此分類下的資源"}},tips:{t:0,b:{t:2,i:[{t:3}],s:"你確定要刪除這條資料嗎？"}},cancelMessage:{t:0,b:{t:2,i:[{t:3}],s:"刪除操作已取消"}},errorMessage:{t:0,b:{t:2,i:[{t:3}],s:"刪除過程中發生了錯誤"}},all:{t:0,b:{t:2,i:[{t:3}],s:"所有"}},image:{t:0,b:{t:2,i:[{t:3}],s:"圖片"}},video:{t:0,b:{t:2,i:[{t:3}],s:"視頻"}},audio:{t:0,b:{t:2,i:[{t:3}],s:"音頻"}},document:{t:0,b:{t:2,i:[{t:3}],s:"文件"}},maxSelect:{t:0,b:{t:2,i:[{t:3,v:"最多選擇"},{t:4,k:"limit"},{t:3,v:"個"}]}},select:{t:0,b:{t:2,i:[{t:3}],s:"選中"}},deselect:{t:0,b:{t:2,i:[{t:3}],s:"取消選中"}},singleSelect:{t:0,b:{t:2,i:[{t:3}],s:"獨選此項"}},view:{t:0,b:{t:2,i:[{t:3}],s:"查看"}},delete:{t:0,b:{t:2,i:[{t:3}],s:"刪除"}},cancel:{t:0,b:{t:2,i:[{t:3}],s:"取消"}},confirm:{t:0,b:{t:2,i:[{t:3}],s:"確認"}}}}})}typeof ne=="function"&&ne(oe);const ht=Te(oe,[["__scopeId","data-v-fc656299"]]);export{ht as M,ae as u};
